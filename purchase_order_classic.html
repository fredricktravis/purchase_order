<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Purchase Order ‚Äî Sixtiq</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--red:#e60000;--maroon:#550000;--ink:#111;--line:#dcdcdc;--paper:#fff;--pad:14px;}
*{box-sizing:border-box}body{font-family:'Open Sans',sans-serif;margin:0;background:#f4f6f8;color:var(--ink);padding:18px;}
.container{max-width:900px;margin:0 auto;background:var(--paper);box-shadow:0 12px 40px rgba(16,24,40,0.08);border-radius:8px;overflow:hidden}
.header{display:flex;gap:12px;padding:18px;border-bottom:6px solid var(--maroon);align-items:flex-start}
.left-head{width:48%}
.logo-box{width:160px;height:72px;border:2px dashed #bbb;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;background:#fff;overflow:hidden}
.company-info{margin-top:8px}
.company-name{font-weight:800;font-size:16px}
.address{font-size:13px;color:#444;margin-top:6px;white-space:pre-line}
.right-head{width:52%;text-align:right;padding-right:8px}
.po-title{font-size:28px;font-weight:900;color:var(--red);letter-spacing:1px}
.meta-row{display:flex;justify-content:flex-end;gap:8px;margin-top:8px;flex-wrap:wrap;}
.meta-item{background:#fff;border:1px solid var(--line);padding:8px;border-radius:6px;min-width:110px}
.meta-item label{font-size:12px;color:#666;display:block;margin-bottom:4px}
.meta-item input,.meta-item select{width:100%;padding:6px;border:1px solid #ddd;border-radius:6px;font-size:14px}

/* Vendor/Ship boxes */
.blocks{display:flex;gap:12px;padding:18px;border-bottom:1px solid var(--line);flex-wrap:wrap}
.block{flex:1;min-width:260px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.block h4{margin:0 0 8px;background:var(--maroon);color:#fff;display:inline-block;padding:6px 10px;border-radius:4px;font-size:13px}

/* Table */
.table-wrap{padding:18px}
.po-table{width:100%;border-collapse:collapse;border:1px solid var(--line);background:#fff}
.po-table th{background:var(--maroon);color:#fff;padding:8px;text-align:left;font-size:13px;border-right:1px solid #fff}
.po-table td{padding:8px;border-bottom:1px solid var(--line);border-right:1px solid var(--line);font-size:13px}
.po-table th:last-child,.po-table td:last-child{border-right:none}
.controls{display:flex;justify-content:flex-end;padding:8px 18px;gap:8px}

/* bottom split: comments left, totals right */
.bottom-row{display:flex;gap:12px;padding:18px;flex-wrap:wrap}
.comments{flex:1;min-width:320px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.comments h4{margin:0 0 8px;background:#eee;padding:6px;border-radius:4px;font-size:13px}
.comments textarea{width:100%;min-height:110px;padding:8px;border-radius:6px;border:1px solid #ddd;font-size:14px}
.totals{width:320px;background:#fff;border:1px solid var(--line);padding:12px;border-radius:6px}
.totals .line{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee}
.totals .line input{width:110px;text-align:right;padding:6px;border-radius:6px;border:1px solid #ddd}
.totals .grand{background:var(--maroon);color:#fff;padding:10px;border-radius:6px;margin-top:8px;font-weight:800;display:flex;justify-content:space-between}

/* footer & preview */
.footer{padding:12px;text-align:center;color:var(--maroon);font-weight:700;border-top:1px dashed var(--line)}
.preview-wrap{padding:12px;display:flex;justify-content:flex-end}
.preview-btn{background:var(--red);color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:800}

/* modal */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;z-index:1200}
.modal{background:#fff;border-radius:8px;max-width:880px;width:96%;max-height:90vh;overflow:auto;box-shadow:0 10px 40px rgba(0,0,0,0.2)}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid var(--line)}
.modal-body{padding:12px}
.btn{padding:8px 12px;border-radius:6px;font-weight:700;cursor:pointer}
.btn-primary{background:var(--red);color:#fff;border:none}
.btn-secondary{background:#fff;border:1px solid #ddd}

/* send menu */
.send-menu{position:absolute;right:12px;top:40px;background:#fff;border:1px solid var(--line);border-radius:6px;display:none;flex-direction:column;z-index:1300;padding:6px;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
.send-menu div{padding:8px 12px;cursor:pointer}
.send-menu div:hover{background:#f6f6f6}

/* success */
.success{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:1400}
.success-card{background:#fff;padding:18px;border-radius:8px;text-align:center;min-width:260px}
.success-check{font-size:36px;color:var(--red);margin-bottom:8px}

/* responsive */
@media(max-width:760px){
  .header{flex-direction:column;align-items:center;text-align:center}
  .left-head,.right-head{width:100%}
  .blocks{flex-direction:column}
  .bottom-row{flex-direction:column}
  .totals{width:100%}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="left-head">
      <label class="logo-box" id="logoBox">Upload Logo</label>
      <div class="company-info">
        <div class="company-name" id="companyName" contenteditable="true">[Company Name]</div>
      </div>
    </div>
    <div class="right-head">
      <div class="po-title">PURCHASE ORDER</div>
      <div class="meta-row">
        <div class="meta-item"><label>Date</label><input id="poDate" placeholder="dd/mm/yyyy"></div>
        <div class="meta-item"><label>PO #</label><input id="poNumber"></div>
        <div class="meta-item"><label>Currency</label><select id="currency"><option value="‚Ç¶">‚Ç¶ Naira</option><option value="$">$ Dollar</option><option value="‚Ç¨">‚Ç¨ Euro</option><option value="¬£">¬£ Pound</option><option value="¬•">¬• Yen</option></select></div>
      </div>
    </div>
  </div>

  <div class="blocks">
    <div class="block">
      <h4>VENDOR</h4>
      <input id="vendorName" placeholder="[Company Name]" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px">
      <textarea id="vendorAddress" placeholder="[Street Address]" style="width:100%;min-height:60px;border:1px solid #ddd;border-radius:6px;padding:8px;margin-top:8px"></textarea>
      <input id="vendorPhone" placeholder="Phone" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:8px">
    </div>
    <div class="block">
      <h4>SHIP TO</h4>
      <input id="shipName" placeholder="[Company Name]" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px">
      <textarea id="shipAddress" placeholder="[Street Address]" style="width:100%;min-height:60px;border:1px solid #ddd;border-radius:6px;padding:8px;margin-top:8px"></textarea>
      <input id="shipPhone" placeholder="Phone" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-top:8px">
    </div>
  </div>

  <div class="table-wrap">
    <table class="po-table" id="itemsTable">
      <thead>
        <tr><th>ITEM #</th><th>DESCRIPTION</th><th>QTY</th><th>UNIT PRICE</th><th style="text-align:right">TOTAL</th></tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>
    <div class="controls"><button class="btn btn-primary" id="addRow">+ Add Item</button></div>
  </div>

  <div class="bottom-row">
    <div class="comments">
      <h4>Comments or Special Instructions</h4>
      <textarea id="comments" placeholder="Comments or special instructions..."></textarea>
    </div>
    <div class="totals">
      <div class="line"><div>SUBTOTAL</div><div id="subTotal">‚Ç¶0.00</div></div>
      <div class="line"><div>TAX</div><div><input id="taxInput" type="number" value="0"></div></div>
      <div class="line"><div>SHIPPING</div><div><input id="shipInput" type="number" value="0"></div></div>
      <div class="line"><div>OTHER</div><div><input id="otherInput" type="number" value="0"></div></div>
      <div class="grand"><div>TOTAL</div><div id="grandTotal">‚Ç¶0.00</div></div>
    </div>
  </div>

  <div class="footer">Powered by Sixtiq</div>
  <div class="preview-wrap"><button class="preview-btn" id="previewBtn">Preview</button></div>
</div>

<!-- Modals -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-header">
      <div style="font-weight:800">Purchase Order Preview</div>
      <div style="position:relative">
        <button class="btn btn-primary" id="sendBtn">Send ‚ñæ</button>
        <div class="send-menu" id="sendMenu">
          <div data-action="whatsapp">Send via WhatsApp</div>
          <div data-action="email">Send via Email</div>
          <div data-action="x">Share on X</div>
          <div data-action="instagram">Share on Instagram</div>
          <div data-action="download">Download PDF</div>
        </div>
        <button class="btn btn-secondary" id="backBtn">Back</button>
      </div>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<div class="success" id="success">
  <div class="success-card">
    <div class="success-check">‚úî</div>
    <div id="successText" style="font-weight:800;margin-top:6px">Purchase Order Sent!</div>
  </div>
</div>

<input id="logoInput" type="file" accept="image/*" style="display:none">

<script>
// (JS logic same as previous version ‚Äî auto rows, totals, preview, send menu, pdf export, success modal, reset+increment PO)
// Helpers
const $ = id => document.getElementById(id);
function fmtDate(d){ return String(d.getDate()).padStart(2,'0') + '/' + String(d.getMonth()+1).padStart(2,'0') + '/' + d.getFullYear(); }
function poKey(){ return 'sixtiq_po_' + new Date().getFullYear(); }
function nextPO(){ let k = poKey(); let n = parseInt(localStorage.getItem(k) || '0',10) + 1; localStorage.setItem(k,String(n)); return 'PO-' + new Date().getFullYear() + '-' + String(n).padStart(4,'0'); }
function incrementPO(){ let k = poKey(); let n = parseInt(localStorage.getItem(k) || '0',10) + 1; localStorage.setItem(k,String(n)); }

// Elements
const logoUpload = $('logoUpload'), logoInput = $('logoInput'), companyName = $('companyName');
const poDate = $('poDate'), poNumber = $('poNumber'), currency = $('currency');
const itemsBody = $('itemsBody'), addBtn = $('addBtn');
const taxInput = $('taxInput'), shipInput = $('shipInput'), otherInput = $('otherInput');
const subTotal = $('subTotal'), grandTotal = $('grandTotal'), comments = $('comments');
const previewBtn = $('previewBtn'), overlay = $('overlay'), modalBody = $('modalBody');
const sendBtn = $('sendBtn'), sendMenu = $('sendMenu'), backBtn = $('backBtn'), closePreview = $('closePreview');
const success = $('success'), successText = $('successText');

let logoData = null;

// Init
function init(){
  poDate.value = fmtDate(new Date());
  poNumber.value = nextPO();
  addItem(); addItem();
  bind();
  recalc();
}
function bind(){
  logoUpload.addEventListener('click', ()=> logoInput.click());
  logoInput.addEventListener('change', onLogo);
  addBtn.addEventListener('click', addItem);
  itemsBody.addEventListener('input', e => { const r = e.target.closest('.item-row'); if(r) updateRow(r); });
  itemsBody.addEventListener('click', e => { if(e.target.classList.contains('del')){ e.target.closest('.item-row').remove(); recalc(); } });
  [taxInput, shipInput, otherInput, currency].forEach(el => el && el.addEventListener('input', recalc));
  previewBtn.addEventListener('click', openPreview);
  backBtn.addEventListener('click', closePreview);
  closePreview.addEventListener('click', closePreview);
  sendBtn.addEventListener('click', toggleSendMenu);
  document.addEventListener('click', e => { if(!sendMenu.contains(e.target) && !sendBtn.contains(e.target)) sendMenu.style.display = 'none'; });
  sendMenu.querySelectorAll('div').forEach(opt => opt.addEventListener('click', onSendOption));
}
function onLogo(e){
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = () => { logoData = reader.result; renderLogo(); };
  reader.readAsDataURL(f);
}
function renderLogo(){ if(logoData) logoUpload.innerHTML = '<img src="'+logoData+'" alt="logo">'; else logoUpload.innerHTML = 'Upload Logo'; }

// Items
function addItem(){
  const row = document.createElement('div');
  row.className = 'item-row';
  row.innerHTML = '<input class="idx" placeholder="Item#">' +
                  '<input class="desc" placeholder="Description" style="flex:1">' +
                  '<input class="qty" type="number" value="1" style="width:70px">' +
                  '<input class="price" type="number" value="0" style="width:100px">' +
                  '<div class="amount">‚Ç¶0.00</div>' +
                  '<button class="del" title="Delete" style="background:none;border:none;cursor:pointer">üóëÔ∏è</button>';
  itemsBody.appendChild(row);
  row.querySelectorAll('input').forEach(i=>i.addEventListener('input', ()=> updateRow(row)));
}
function updateRow(r){
  const q = parseFloat(r.querySelector('.qty').value) || 0;
  const p = parseFloat(r.querySelector('.price').value) || 0;
  const a = q*p;
  r.querySelector('.amount').textContent = (currency.value || '‚Ç¶') + a.toFixed(2);
  recalc();
}
function recalc(){
  let sum = 0;
  document.querySelectorAll('.item-row .amount').forEach(el => {
    const v = parseFloat(el.textContent.replace(/[^0-9.-]+/g,'')) || 0;
    sum += v; });
  const taxPercent = parseFloat(taxInput.value) || 0; // user enters %
  const taxAmount = (sum * taxPercent) / 100;         // calculate % of subtotal
  const s = parseFloat(shipInput.value) || 0;         // flat shipping amount
  const o = parseFloat(otherInput.value) || 0;        // flat other charges
  const g = sum + taxAmount + s + o;

  subTotal.textContent = (currency.value || '‚Ç¶') + sum.toFixed(2);
  grandTotal.textContent = (currency.value || '‚Ç¶') + g.toFixed(2);
}

// Preview & PDF
function buildPreview(){
  const vendor = {name: $('vendorName').value, addr: $('vendorAddress').value, phone: $('vendorPhone').value};
  const ship = {name: $('shipName').value, addr: $('shipAddress').value, phone: $('shipPhone').value};
  const rows = Array.from(document.querySelectorAll('.item-row')).map(r => ({
    idx: r.querySelector('.idx').value,
    desc: r.querySelector('.desc').value,
    qty: r.querySelector('.qty').value,
    price: r.querySelector('.price').value,
    amt: r.querySelector('.amount').textContent
  }));
  const sub = subTotal.textContent;
  const taxPercent = parseFloat(taxInput.value)||0;
  const s = parseFloat(shipInput.value)||0;
  const o = parseFloat(otherInput.value)||0;
  const grand = grandTotal.textContent;
  const cur = currency.value || '‚Ç¶';
  const logoHtml = logoData ? '<img src="'+logoData+'" style="max-width:140px;max-height:70px;object-fit:contain">' : '<div style="width:140px;height:70px;border:1px solid #eee;display:flex;align-items:center;justify-content:center;color:#999">Logo</div>';
  let rowsHtml = rows.map(r=>`<tr><td style="padding:6px">${escapeHtml(r.idx)}</td><td style="padding:6px">${escapeHtml(r.desc)}</td><td style="padding:6px">${r.qty}</td><td style="padding:6px;text-align:right">${parseFloat(r.price||0).toFixed(2)}</td><td style="padding:6px;text-align:right">${escapeHtml(r.amt)}</td></tr>`).join('');
  return `
    <div style="font-family:Open Sans,Arial;padding:12px;color:#111">
      <div style="display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #111;padding-bottom:8px;margin-bottom:12px">
        <div style="display:flex;gap:12px;align-items:center">${logoHtml}<div style="font-weight:800">${escapeHtml(companyName.value)}</div></div>
        <div style="text-align:right"><div style="font-weight:900;color:${getComputedStyle(document.documentElement).getPropertyValue('--red') || '#e60000'}">PURCHASE ORDER</div><div style="font-size:13px">Date: ${escapeHtml(poDate.value)}</div><div style="font-size:13px">PO #: ${escapeHtml(poNumber.value)}</div></div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
        <div style="flex:1;min-width:200px;background:#fafafa;padding:10px;border-radius:6px;border:1px solid #eee"><strong style="color:${getComputedStyle(document.documentElement).getPropertyValue('--maroon') || '#550000'}">Vendor</strong><div>${escapeHtml(vendor.name)}</div><div style="font-size:13px;color:#555">${escapeHtml(vendor.addr)}</div><div style="font-size:13px;color:#555">${escapeHtml(vendor.phone)}</div></div>
        <div style="flex:1;min-width:200px;background:#fafafa;padding:10px;border-radius:6px;border:1px solid #eee"><strong style="color:${getComputedStyle(document.documentElement).getPropertyValue('--maroon') || '#550000'}">Ship To</strong><div>${escapeHtml(ship.name)}</div><div style="font-size:13px;color:#555">${escapeHtml(ship.addr)}</div><div style="font-size:13px;color:#555">${escapeHtml(ship.phone)}</div></div>
      </div>
      <table style="width:100%;border-collapse:collapse;border:1px solid #e9e9e9"><thead style="background:#111;color:#fff"><tr><th style="padding:8px;text-align:left">Item #</th><th style="padding:8px;text-align:left">Description</th><th style="padding:8px;text-align:left">Qty</th><th style="padding:8px;text-align:right">Unit</th><th style="padding:8px;text-align:right">Total</th></tr></thead><tbody>${rowsHtml}</tbody></table>
      <div style="display:flex;justify-content:flex-end;margin-top:10px"><div style="min-width:300px"><div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee"><span>Subtotal</span><span>${sub}</span></div><div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee"><span>Tax</span><span>${cur}${t.toFixed(2)}</span></div><div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee"><span>Shipping</span><span>${cur}${s.toFixed(2)}</span></div><div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eee"><span>Other</span><span>${cur}${o.toFixed(2)}</span></div><div style="background:${getComputedStyle(document.documentElement).getPropertyValue('--maroon') || '#550000'};color:#fff;padding:10px;border-radius:6px;display:flex;justify-content:space-between;font-weight:800;margin-top:8px"><span>Grand Total</span><span>${grand}</span></div></div></div>
      <div style="margin-top:12px"><strong style="color:${getComputedStyle(document.documentElement).getPropertyValue('--maroon') || '#550000'}">Comments</strong><div style="white-space:pre-wrap;margin-top:6px">${escapeHtml(comments.value)}</div></div>
      <div style="text-align:center;color:${getComputedStyle(document.documentElement).getPropertyValue('--maroon') || '#550000'};font-weight:700;margin-top:14px">Powered by Sixtiq</div>
    </div>
  `;
}
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
async function openPreview(){
  if(!companyName.value.trim()){ alert('Please enter company name'); companyName.focus(); return; }
  const rows = document.querySelectorAll('.item-row');
  if(rows.length===0){ alert('Add at least one item'); return; }
  modalBody.innerHTML = buildPreview();
  overlay.style.display = 'flex';
}
function closePreview(){ overlay.style.display = 'none'; sendMenu.style.display='none'; }

function toggleSendMenu(){ sendMenu.style.display = (sendMenu.style.display === 'flex') ? 'none' : 'flex'; }

async function onSendOption(e){
  const action = e.currentTarget.getAttribute('data-action');
  sendMenu.style.display = 'none';
  if(action === 'download'){
    await exportPDF_A4();
    showSuccess('Purchase Order downloaded!');
  } else {
    showSuccess('Purchase Order sent!');
  }
  setTimeout(()=> resetForm(), 1200);
}

async function exportPDF_A4(){
  const html = buildPreview();
  const wrapper = document.createElement('div');
  wrapper.style.width = '210mm';
  wrapper.style.minHeight = '297mm';
  wrapper.style.padding = '20px';
  wrapper.style.background = '#fff';
  wrapper.innerHTML = html;
  document.body.appendChild(wrapper);
  const canvas = await html2canvas(wrapper, {scale:2, useCORS:true, backgroundColor:'#ffffff'});
  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({unit:'pt', format:'a4'});
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pdfWidth = pageWidth - 40;
  const ratio = canvas.width / pdfWidth;
  const pdfHeight = canvas.height / ratio;
  pdf.addImage(imgData, 'PNG', 20, 20, pdfWidth, pdfHeight);
  pdf.save((poNumber.value || 'purchase-order') + '.pdf');
  document.body.removeChild(wrapper);
}

function showSuccess(msg){
  successText.textContent = msg;
  success.style.display = 'flex';
  setTimeout(()=> { success.style.display = 'none'; }, 1200);
}

function resetForm(){
  incrementPO();
  companyName.value = '';
  $('vendorName').value=''; $('vendorAddress').value=''; $('vendorPhone').value='';
  $('shipName').value=''; $('shipAddress').value=''; $('shipPhone').value='';
  comments.value='';
  taxInput.value='0'; shipInput.value='0'; otherInput.value='0';
  itemsBody.innerHTML=''; addItem(); addItem();
  logoData = null; renderLogo();
  recalc();
  poDate.value = fmtDate(new Date());
  poNumber.value = nextPO();
  overlay.style.display = 'none';
}

init();
  
</script>
</body>

</html>
